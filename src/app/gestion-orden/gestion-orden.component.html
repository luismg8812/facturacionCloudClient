<app-menu></app-menu>
<div class="container-fluid main">
  <div class="form-row">
    <h4 class="mt-3">Gestión Orden de trabajo/Factura</h4>
  </div>

  <!-- Nav tabs -->
  <ul class="nav nav-tabs">
    <li class="nav-item">
      <a class="nav-link active" data-toggle="tab" href="#orden">Gestión Orden</a>
    </li>
    <li class="nav-item">
      <a class="nav-link" data-toggle="tab" href="#factura">Gestión Factura</a>
    </li>
  </ul>

  <!-- Tab panes -->
  <div class="tab-content">
    <div class="tab-pane container-fluid active" id="orden">
      <br />
      <div class="form-row">
        <div class="form-group col-md-2 col-sm-12 ">
          <button type="button" class="btn btn-primary " id="anterior"
            (click)="teclaAnteriorSiguiente('anterior')">Anterior</button>

          <button type="button" class="btn btn-primary ml-2" id="siguiente"
            (click)="teclaAnteriorSiguiente('siguiente')">Siguiente</button>
        </div>
        <div class="form-group col-md-2 col-sm-12 ">
          <!-- Button trigger modal -->
          <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#buscarModal">
            Buscar
          </button>
          <button type="button" class="btn btn-primary ml-2" id="imprimir">Imprimir</button>
        </div>
        <div class="form-group col-md-4 col-sm-12 ">
          <button type="button" class="btn btn-primary " id="Nueva" (click)="nuevaOrden()">Nueva Orden de
            trabajo</button>
          <button type="button" class="btn btn-primary ml-2" data-toggle="modal" data-target="#entregarModal">
            Entregar Pedido
          </button>
        </div>
      </div>
      <div class="form-row">
        <div class="form-group col-md-12">
          <b>Usuario Que crea:</b> {{nombreUsuario()}}
        </div>
        <div class="form-group col-md-4">
          <b># Orden de pedido:</b> {{documento.documento_id}}
        </div>
        <div class="form-group col-md-4">
          <b>Fecha entrada:</b> {{documento.fecha_registro | date: 'dd/MM/yyyy, h:mm a'}}
        </div>
      </div>
      <div class="form-row">
        <div class="form-group col-md-4 col-sm-2">
          <b>Fecha entrega:</b> {{documento.fecha_entrega | date: 'dd/MM/yyyy, h:mm a'}}
        </div>
        <div class="form-group col-md-4 col-sm-2">
          <input list="browsers" name="clientePV" #clientePV placeholder="Cliente" class="form-control" id="clientePV"
            (change)="clienteSelectFun(clientePV)">
          <datalist id="browsers">
            <option *ngFor="let cliente of clientes" [value]="cliente.nombre">
              Identificación: {{cliente.documento}} id:{{cliente.cliente_id}}
            </option>
          </datalist>
        </div>
        <div class="form-group col-md-4 col-sm-2">
          <input class="form-control" id="placa" placeholder="* Placa" name="placa" #placa required
            (blur)="agregarPlaca(placa)">
        </div>
      </div>
      
      <div class="form-row">
        <div class="form-group col-md-4 col-sm-2">
          <input list="marcas" name="marca" #marca placeholder="Marca" class="form-control" id="marca"
          (change)="marcaSelect(marca)">
        <datalist id="marcas">
          <option *ngFor="let mar of marcaList" [value]="mar.nombre"> 
          </option>
        </datalist>
        </div>
        <div class="form-group col-md-4 col-sm-2">
          <input list="modelos" name="modelo" #modelo placeholder="modelo" class="form-control" id="modelo"
          (change)="guardarModelo(modelo)">
        <datalist id="modelos">
          <option *ngFor="let model of modeloList" [value]="model.nombre"> 
          </option>
        </datalist>
        </div>
        <div class="form-group col-md-4 col-sm-2">
          <select class="form-control" id="linea" placeholder="Marca" #linea  (change)="asignarLinea(linea)">
            <option>Seleccione Linea</option>
            <option>Automovil</option>
            <option>Camioneta</option>
            <option>Moto</option>
          </select>
        </div>
      </div>

      <div class="form-row">
        <div class="form-group col-md-6 col-sm-1">
          <textarea class="form-control mb-2" id="descripcionCliente" #descripcionCliente
            placeholder="Descripción cliente" required
            (blur)="agregarDescripcionCliente(descripcionCliente)"></textarea>
          <textarea class="form-control " (blur)="agregarObservacion(observacion)" id="observacion" #observacion
            placeholder="Observación" required></textarea>
        </div>
        <div class="form-group col-md-6 col-sm-1">
          <div class="container" *ngIf="downloadURL | async; let url">
            <img [src]="url" alt="Image from AngularFireStorage" width="100%" height="200px">
          </div>
          <div class="container" *ngIf="downloadURLLocal ; let url">
            <img [src]="url" alt="Image from AngularFireStorage" width="100%" height="200px">
          </div>
        </div>
      </div>
      <div class="form-row">
        <div class="form-group col-md-6 col-sm-1">
          <!-- Button trigger modal -->
          <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#exampleModal">
            Agregar repuesto
          </button>
        </div>
        <div class="form-group col-md-6 col-sm-1">
          <h5>Total Orden: ${{formatearNumber(valorTotal)}}</h5>
        </div>
      </div>
      <br />

      <table class="table table-hover">
        <thead>
          <tr>
            <th scope="col">Opciones</th>
            <th scope="col">Nombre</th>
            <th scope="col">Cant.</th>
            <th scope="col" class="d-none d-sm-block">Precio Compra</th>
            <th scope="col">Total</th>
            <th scope="col" class="d-none d-sm-block">Precio Venta</th>

          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let ordenes of detallesList">
            <th scope="row">
              <button type="button" (click)="editarItem(ordenes)"
                class="btn btn-secondary btn-sm" data-toggle="modal" data-target="#exampleModal">
                Editar
              </button>
              <!-- Button trigger modal -->
              <button type="button" (click)="eliminarItem(ordenes)" class="btn btn-secondary btn-sm" data-toggle="modal"
                data-target="#eliminarModal">
                Eliminar
               </button>
            </th>
            <td>{{ordenes.descripcion}}</td>
            <td>{{ordenes.cantidad}}</td>
            <td class="d-none d-sm-block">${{formatearNumber(ordenes.unitario)}}</td>
            <td>${{formatearNumber(ordenes.parcial)}}</td>
            <td class="d-none d-sm-block">${{formatearNumber(ordenes.impreso_comanda)}}</td>

          </tr>
        </tbody>
      </table>

      <!-- Modal nuevo repuesto-->
      <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
        aria-hidden="true">
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="exampleModalLabel">Agregar repuesto</h5>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body">
              <div class="form-row">
                <div class="form-group col-md-6 col-sm-2" *ngIf="productoFijoActivo">
                  <input list="articulos" name="articuloC" [value]="articuloPV" #articuloC placeholder="Articulo" class="form-control"
                    id="articuloC"  (change)="articuloSelect(articuloC)"
                    >
                  <datalist id="articulos">
                    <option *ngFor="let producto of productosAll" [value]="producto.nombre">
                      Costo:{{producto.costo_publico}} Cantidad:{{producto.cantidad}} id:{{producto.producto_id}}
                    </option>
                  </datalist>
                </div>
                <div class="form-group col-md-6 col-sm-2" *ngIf="!productoFijoActivo">
                  <textarea class="form-control " id="item" #item placeholder="Nombre repuesto" required></textarea>
                </div>
                <div class="form-group col-md-6 col-sm-2">
                  <input class="form-control" id="cantidad" type="number" placeholder="* Cantidad" name="cantidad"
                    #cantidad required>
                </div>
              </div>
              <div class="form-row">
                <div class="form-group col-md-6 col-sm-2">
                  <input class="form-control" id="pCompra" type="number" placeholder="* Precio de compra" name="pCompra"
                    #pCompra required>
                </div>
                <div class="form-group col-md-6 col-sm-2">
                  <input class="form-control" id="pVenta" type="number" placeholder="* Precio de venta" name="pVenta"
                    #pVenta required>
                </div>
              </div>
              <br />
              <div class="form-row">

                <div class="form-group col-md-12 col-sm-1">
                  <input type="file" class="form-control-file" capture="camera" #fotoRepuesto id="fotoRepuesto"
                    aria-describedby="fileHelp">
                </div>
              </div>
              <div class="form-row">
                <div class="form-group col-md-6 col-sm-1">
                  <div class="container" *ngIf="downloadURL2 | async; let url2">
                    <img [src]="url2" alt="Image from AngularFireStorage" width="100%" height="200px">
                  </div>
                </div>
              </div>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancelar</button>
              <button type="button" class="btn btn-primary"
                (click)="agregardetalle()">Agregar</button>
            </div>
          </div>
        </div>
      </div>

      <!-- Eliminar Modal -->
      <div class="modal fade" id="eliminarModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
        aria-hidden="true">
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="exampleModalLabel">Eliminar Repuesto</h5>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body">
              Esta seguro de eliminar este repuesto?
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancelar</button>
              <button type="button" class="btn btn-primary" (click)="eliminar()">Eliminar</button>
            </div>
          </div>
        </div>
      </div>

      <!-- Modal buscar -->
      <div class="modal fade  bd-example-modal-xl" id="buscarModal" tabindex="-1" role="dialog"
        aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="exampleModalLabel">Buscar Orden de trabajo</h5>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body">
              <div class="form-row">
                <div class="form-group col-md-6 col-sm-1">
                  Fecha Inicial
                  <input class="form-control" type="date" value="2020-01-01" id="fechaIni" #fechaIni>
                </div>
                <div class="form-group col-md-6 col-sm-1">
                  Fecha Final
                  <input class="form-control" type="date" value="2020-12-31" id="fechaFin" #fechaFin>
                </div>
              </div>
              <div class="form-row">
                <div class="form-group col-md-6 col-sm-2">
                  <input list="browsers2" name="clienteBuscarPV" #clienteBuscarPV placeholder="Cliente"
                    class="form-control" id="clienteBuscarPV">
                  <datalist id="browsers2">
                    <option *ngFor="let cliente of clientes" [value]="cliente.nombre">
                      Identificación: {{cliente.documento}} id:{{cliente.cliente_id}}
                    </option>
                  </datalist>
                </div>
                <div class="form-group col-md-6 col-sm-2">
                  <input class="form-control" id="placaBuscar" placeholder="Placa" name="placaBuscar" #placaBuscar
                    required>
                </div>
              </div>
              <button type="button" class="btn btn-primary"
                (click)="buscarOrdenes(placaBuscar,clienteBuscarPV,fechaIni,fechaFin)">Buscar</button>
              <br />
              <table class="table table-hover">
                <thead>
                  <tr>
                    <th scope="col">Opciones</th>
                    <th scope="col"># Orden</th>
                    <th scope="col">Nombre Cliente</th>
                    <th scope="col">Placa</th>
                    <th scope="col">Encargado</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let ordenes of ordenesBuscarList">
                    <th scope="row">
                      <button type="button" class="btn btn-secondary btn-sm" data-toggle="modal"
                        (click)="editarOrden(ordenes)">
                        Editar
                      </button>
                    </th>
                    <td>{{ordenes.documento_id}}</td>
                    <td>{{nombreClienteFun(ordenes.cliente_id)}}</td>
                    <td>{{ordenes.detalle_entrada}}</td>
                    <td>{{nombreUsuarioFiltro(ordenes.usuario_id)}}</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <!-- Eliminar Modal -->
      <div class="modal fade" id="entregarModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
        aria-hidden="true">
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="exampleModalLabel">Entregar Pedido</h5>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body">
              Esta seguro de entregar el pedido y cerrar la orden?
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancelar</button>
              <button type="button" class="btn btn-primary" (click)="entregar()">Entregar</button>
            </div>
          </div>
        </div>
      </div>
      <!-- crear cliente Modal -->
      <div class="modal fade" id="crearClienteModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
        aria-hidden="true">
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="exampleModalLabel">Crear Cliente</h5>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body">
              <div class="form-row">
                <div class="form-group col-md-6 col-sm-6">
                  <input class="form-control" id="nombreCliente" placeholder="* Nombres cliente" name="nombreCliente"
                    #nombreCliente required [(ngModel)]="clienteNew.nombre">
                </div>
                <div class="form-group col-md-6 col-sm-6">
                  <input class="form-control" id="apellidoCliente" placeholder=" Apellidos cliente" name="apellidoCliente"
                  #apellidoCliente required [(ngModel)]="clienteNew.apellidos">
                </div>
              </div>
              <div class="form-row">
                <div class="form-group col-md-6 col-sm-6">
                  <input class="form-control" id="documentoCliente" placeholder="* Documento cliente" name="documentoCliente"
                    #documentoCliente required [(ngModel)]="clienteNew.documento">
                </div>
                <div class="form-group col-md-6 col-sm-6">
                  <input class="form-control" id="mailCliente" placeholder="* Correo cliente" name="mailCliente"
                  #mailCliente required [(ngModel)]="clienteNew.mail">
                </div>
              </div>
              <div class="form-row">
                <div class="form-group col-md-6 col-sm-6">
                  <input class="form-control" id="direccionCliente" placeholder="* Dirección cliente" name="direccionCliente"
                    #direccionCliente required [(ngModel)]="clienteNew.direccion">
                </div>
                <div class="form-group col-md-6 col-sm-6">
                  <input class="form-control" id="fijoCliente" placeholder="* Fijo cliente" name="fijoCliente"
                  #fijoCliente required [(ngModel)]="clienteNew.fijo">
                </div>
              </div>
            </div>
            
          
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancelar</button>
              <button type="button" class="btn btn-primary" (click)="CrearCliente()">Crear</button>
            </div>
          </div>
        </div>
      </div>

    </div>
    <div class="tab-pane container fade" id="factura">En desarrollo...</div>

  </div>
</div>